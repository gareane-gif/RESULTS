<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ø¸ÙˆÙ…Ø© Ø¥Ø¯Ø§Ø±Ø© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            background: white;
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }

        .subjects-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .subject-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .subject-item input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .student-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }

        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f8f9fa;
        }

        .student-info h3 {
            color: #333;
            font-size: 1.5em;
            margin-bottom: 8px;
        }

        .student-info p {
            color: #666;
            margin: 4px 0;
            font-size: 0.95em;
        }

        .subjects-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .subjects-table th,
        .subjects-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #e9ecef;
            font-size: 14px;
        }

        .subjects-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        .subjects-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .search-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .search-input {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-input input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 18px;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .gpa-display {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .gpa-excellent {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .gpa-very-good {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .gpa-good {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #333;
        }

        .gpa-pass {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            color: white;
        }

        .gpa-fail {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .blocked-message {
            background: #f8d7da;
            color: #721c24;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            border: 2px solid #dc3545;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .tabs {
                flex-direction: column;
            }

            .subject-item {
                grid-template-columns: 1fr;
                gap: 5px;
            }

            .student-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .search-input {
                flex-direction: column;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ Ù…Ù†Ø¸ÙˆÙ…Ø© Ø¥Ø¯Ø§Ø±Ø© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨</h1>
            <p>Ù†Ø¸Ø§Ù… Ø´Ø§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø¨Ø­Ø« Ø¹Ù†Ù‡Ø§</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('add-student')">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
            <button class="tab" onclick="showTab('list')">ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</button>
            <button class="tab" onclick="showTab('search-student')">ğŸ” Ø¨Ø­Ø« Ø·Ø§Ù„Ø¨</button>
            <button class="tab" onclick="showTab('block-student')">ğŸš« Ø­Ø¬Ø¨ Ù†ØªÙŠØ¬Ø©</button>
        </div>

        <!-- Add Student Tab -->
        <div id="add-student" class="tab-content active">
            <h2>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
            <form id="studentForm">
                <div class="grid-2">
                    <div class="form-group">
                        <label for="studentId">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</label>
                        <input type="text" id="studentId" required placeholder="Ù…Ø«Ø§Ù„: CO242001">
                    </div>
                    <div class="form-group">
                        <label for="studentName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
                        <input type="text" id="studentName" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„ÙƒØ§Ù…Ù„">
                    </div>
                </div>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label for="department">Ø§Ù„Ù‚Ø³Ù…:</label>
                        <input type="text" id="department" required placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³ÙˆØ¨">
                    </div>
                    <div class="form-group">
                        <label for="semester">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</label>
                        <select id="semester" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØµÙ„</option>
                            <option value="1">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„</option>
                            <option value="2">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                            <option value="3">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù„Ø«</option>
                            <option value="4">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø±Ø§Ø¨Ø¹</option>
                        </select>
                    </div>
                </div>
                
                <div class="subjects-container">
                    <h3>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h3>
                    <div id="subjectsContainer">
                        <div class="subject-item">
                            <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©" class="subject-name">
                            <input type="number" placeholder="Ø§Ù„ÙˆØ­Ø¯Ø§Øª" class="subject-units" min="1" max="6">
                            <input type="number" placeholder="Ø§Ù„Ø£Ø¹Ù…Ø§Ù„" class="subject-classwork" min="0" max="40">
                            <input type="number" placeholder="Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ" class="subject-final" min="0" max="60">
                            <input type="number" placeholder="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" class="subject-total" min="0" max="100" readonly>
                            <button type="button" onclick="removeSubject(this)" class="btn btn-danger">Ø­Ø°Ù</button>
                        </div>
                    </div>
                    <button type="button" onclick="addSubject()" class="btn btn-info">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</button>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" class="btn btn-success">âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨</button>
                    <button type="button" onclick="clearForm()" class="btn btn-warning">ğŸ”„ Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
                </div>
            </form>
        </div>

        <!-- Students List Tab -->
        <div id="list" class="tab-content">
            <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
            <div style="margin-bottom: 20px;">
                <button onclick="displayStudents()" class="btn btn-info">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
            </div>
            <div id="allStudentsList"></div>
        </div>

        <!-- Search Student Tab -->
        <div id="search-student" class="tab-content">
            <div class="search-section">
                <h2>ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨</h2>
                <div class="search-input">
                    <input type="text" id="searchId" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
                    <button onclick="searchStudent()" class="btn">ğŸ” Ø¨Ø­Ø«</button>
                </div>
                <div id="searchResults"></div>
            </div>
        </div>

        <!-- Block Student Tab -->
        <div id="block-student" class="tab-content">
            <h2>Ø­Ø¬Ø¨ Ù†ØªÙŠØ¬Ø© Ø·Ø§Ù„Ø¨</h2>
            <div class="grid-2">
                <div class="form-group">
                    <label for="blockStudentId">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ:</label>
                    <input type="text" id="blockStudentId" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ">
                </div>
                <div class="form-group">
                    <label for="blockReason">Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¬Ø¨:</label>
                    <textarea id="blockReason" placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¬Ø¨" rows="3"></textarea>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="blockStudent()" class="btn btn-danger">ğŸš« Ø­Ø¬Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
                <button onclick="unblockStudent()" class="btn btn-success">âœ… Ø±ÙØ¹ Ø§Ù„Ø­Ø¬Ø¨</button>
                <button onclick="loadBlockedStudents()" class="btn btn-info">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø¬ÙˆØ¨ÙŠÙ†</button>
            </div>
            <div id="blockedStudentsList" style="margin-top: 20px;"></div>
        </div>
    </div>

    <!-- Status Message -->
    <div id="statusMessage" class="status-message" style="display: none;"></div>

    <script>
        // Initialize data
        let students = JSON.parse(localStorage.getItem('students')) || [];
        let blockedStudents = JSON.parse(localStorage.getItem('blockedStudents')) || [];

        // Initialize on page load
        window.onload = function() {
            console.log('ğŸ“ Fixed Student Management System Loaded');
        };

        // Tab Management
        function showTab(tabId) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            
            if (tabId === 'list') {
                displayStudents();
            }
        }

        // Subject Management
        function addSubject() {
            const container = document.getElementById('subjectsContainer');
            const subjectDiv = document.createElement('div');
            subjectDiv.className = 'subject-item';
            subjectDiv.innerHTML = `
                <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©" class="subject-name">
                <input type="number" placeholder="Ø§Ù„ÙˆØ­Ø¯Ø§Øª" class="subject-units" min="1" max="6">
                <input type="number" placeholder="Ø§Ù„Ø£Ø¹Ù…Ø§Ù„" class="subject-classwork" min="0" max="40">
                <input type="number" placeholder="Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ" class="subject-final" min="0" max="60">
                <input type="number" placeholder="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" class="subject-total" min="0" max="100" readonly>
                <button type="button" onclick="removeSubject(this)" class="btn btn-danger">Ø­Ø°Ù</button>
            `;
            container.appendChild(subjectDiv);
            
            const classworkInput = subjectDiv.querySelector('.subject-classwork');
            const finalInput = subjectDiv.querySelector('.subject-final');
            const totalInput = subjectDiv.querySelector('.subject-total');
            
            classworkInput.addEventListener('input', () => calculateSubjectTotal(subjectDiv));
            finalInput.addEventListener('input', () => calculateSubjectTotal(subjectDiv));
        }
        
        function removeSubject(button) {
            button.parentElement.remove();
        }
        
        function calculateSubjectTotal(subjectDiv) {
            const classwork = parseFloat(subjectDiv.querySelector('.subject-classwork').value) || 0;
            const final = parseFloat(subjectDiv.querySelector('.subject-final').value) || 0;
            const total = classwork + final;
            subjectDiv.querySelector('.subject-total').value = total;
        }

        // Form Management
        function clearForm() {
            document.getElementById('studentForm').reset();
            const container = document.getElementById('subjectsContainer');
            container.innerHTML = `
                <div class="subject-item">
                    <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©" class="subject-name">
                    <input type="number" placeholder="Ø§Ù„ÙˆØ­Ø¯Ø§Øª" class="subject-units" min="1" max="6">
                    <input type="number" placeholder="Ø§Ù„Ø£Ø¹Ù…Ø§Ù„" class="subject-classwork" min="0" max="40">
                    <input type="number" placeholder="Ù†Ù‡Ø§Ø¦ÙŠ" class="subject-final" min="0" max="60">
                    <input type="number" placeholder="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" class="subject-total" min="0" max="100" readonly>
                    <button type="button" onclick="removeSubject(this)" class="btn btn-danger">Ø­Ø°Ù</button>
                </div>
            `;
        }

        // Student Management
        document.getElementById('studentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const studentId = document.getElementById('studentId').value;
            const studentName = document.getElementById('studentName').value;
            const department = document.getElementById('department').value;
            const semester = document.getElementById('semester').value;
            
            if (students.some(s => s.id === studentId)) {
                showStatus('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                return;
            }
            
            const subjects = [];
            const subjectItems = document.querySelectorAll('.subject-item');
            
            subjectItems.forEach(item => {
                const name = item.querySelector('.subject-name').value;
                const units = parseInt(item.querySelector('.subject-units').value) || 0;
                const classwork = parseFloat(item.querySelector('.subject-classwork').value) || 0;
                const final = parseFloat(item.querySelector('.subject-final').value) || 0;
                const total = parseFloat(item.querySelector('.subject-total').value) || 0;
                
                if (name && units > 0) {
                    subjects.push({ name, units, classwork, final, total });
                }
            });
            
            if (subjects.length === 0) {
                showStatus('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                return;
            }
            
            const student = {
                id: studentId,
                name: studentName,
                department: department,
                semester: semester,
                subjects: subjects,
                addedDate: new Date().toISOString()
            };
            
            students.push(student);
            localStorage.setItem('students', JSON.stringify(students));
            
            clearForm();
            showStatus(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ ${studentName} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        });

        // Display Students
        function displayStudents() {
            const listDiv = document.getElementById('allStudentsList');
            
            if (students.length === 0) {
                listDiv.innerHTML = '<div class="no-results">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø§Ø¨</div>';
                return;
            }
            
            let html = '';
            students.forEach(student => {
                const gpa = calculateGPA(student.subjects);
                const status = calculateSemesterStatus(student.subjects, gpa);
                const isBlocked = blockedStudents.some(b => b.studentId === student.id);
                
                html += `
                    <div class="student-card">
                        <div class="student-header">
                            <div class="student-info">
                                <h3>${student.name}</h3>
                                <p><strong>Ø§Ù„Ø±Ù‚Ù…:</strong> ${student.id}</p>
                                <p><strong>Ø§Ù„Ù‚Ø³Ù…:</strong> ${student.department}</p>
                                <p><strong>Ø§Ù„ÙØµÙ„:</strong> ${student.semester}</p>
                                <p><strong>Ø§Ù„Ù…Ø¹Ø¯Ù„:</strong> ${gpa.toFixed(2)}%</p>
                                <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span style="color: ${status === 'Ù…Ù†Ù‚ÙˆÙ„' ? 'green' : 'red'}; font-weight: bold;">${status}</span></p>
                                ${isBlocked ? '<p style="color: red; font-weight: bold;">ğŸš« Ù†ØªÙŠØ¬Ø© Ù…Ø­Ø¬ÙˆØ¨Ø©</p>' : ''}
                            </div>
                            <div>
                                <button onclick="deleteStudent('${student.id}')" class="btn btn-danger">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                            </div>
                        </div>
                        <table class="subjects-table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                                    <th>ÙˆØ­Ø¯Ø§Øª</th>
                                    <th>Ø£Ø¹Ù…Ø§Ù„</th>
                                    <th>Ù†Ù‡Ø§Ø¦ÙŠ</th>
                                    <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                    <th>ØªÙ‚Ø¯ÙŠØ±</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${student.subjects.map(subject => `
                                    <tr>
                                        <td>${subject.name}</td>
                                        <td>${subject.units}</td>
                                        <td>${subject.classwork}</td>
                                        <td>${subject.final}</td>
                                        <td>${subject.total}</td>
                                        <td>${getGrade(subject.total)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            });
            
            listDiv.innerHTML = html;
        }

        // Search Student
        function searchStudent() {
            const searchTerm = document.getElementById('searchId').value.trim();
            const resultsDiv = document.getElementById('searchResults');
            
            if (!searchTerm) {
                resultsDiv.innerHTML = '<div class="no-results">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</div>';
                return;
            }
            
            const student = students.find(s => 
                s.id === searchTerm || 
                s.name.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            if (!student) {
                resultsDiv.innerHTML = '<div class="no-results">Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</div>';
                return;
            }
            
            const blocked = blockedStudents.find(b => b.studentId === student.id);
            
            if (blocked) {
                resultsDiv.innerHTML = `
                    <div class="student-card">
                        <div class="student-header">
                            <div class="student-info">
                                <h3>${student.name}</h3>
                                <p><strong>Ø§Ù„Ø±Ù‚Ù…:</strong> ${student.id}</p>
                                <p><strong>Ø§Ù„Ù‚Ø³Ù…:</strong> ${student.department}</p>
                                <p><strong>Ø§Ù„ÙØµÙ„:</strong> ${student.semester}</p>
                            </div>
                        </div>
                        <div class="blocked-message">
                            <h3>ğŸš« Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ø­Ø¬ÙˆØ¨Ø©</h3>
                            <p><strong>Ø§Ù„Ø³Ø¨Ø¨:</strong> ${blocked.reason}</p>
                            <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(blocked.date).toLocaleDateString('ar-SA')}</p>
                            <p style="margin-top: 15px;">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù„Ø¬Ù†Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            const gpa = calculateGPA(student.subjects);
            const status = calculateSemesterStatus(student.subjects, gpa);
            const passedSubjects = student.subjects.filter(s => s.total >= 50).length;
            const failedSubjects = student.subjects.filter(s => s.total < 50).length;
            
            resultsDiv.innerHTML = `
                <div class="student-card">
                    <div class="student-header">
                        <div class="student-info">
                            <h3>${student.name}</h3>
                            <p><strong>Ø§Ù„Ø±Ù‚Ù…:</strong> ${student.id}</p>
                            <p><strong>Ø§Ù„Ù‚Ø³Ù…:</strong> ${student.department}</p>
                            <p><strong>Ø§Ù„ÙØµÙ„:</strong> ${student.semester}</p>
                            <p><strong>Ø§Ù„Ù…Ø¹Ø¯Ù„:</strong> ${gpa.toFixed(2)}%</p>
                            <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span style="color: ${status === 'Ù…Ù†Ù‚ÙˆÙ„' ? 'green' : 'red'}; font-weight: bold;">${status}</span></p>
                        </div>
                    </div>
                    <div class="gpa-display gpa-${getGpaClass(gpa)}">
                        Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…: ${gpa.toFixed(2)}%
                        <br>
                        Ø§Ù„Ø­Ø§Ù„Ø©: ${status}
                    </div>
                    <div class="grid-2">
                        <div>
                            <strong>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù†Ø§Ø¬Ø­Ø©:</strong>
                            <p style="color: #28a745; font-weight: bold;">${passedSubjects}</p>
                        </div>
                        <div>
                            <strong>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø±Ø§Ø³Ø¨Ø©:</strong>
                            <p style="color: #dc3545; font-weight: bold;">${failedSubjects}</p>
                        </div>
                    </div>
                    <table class="subjects-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                                <th>ÙˆØ­Ø¯Ø§Øª</th>
                                <th>Ø£Ø¹Ù…Ø§Ù„</th>
                                <th>Ù†Ù‡Ø§Ø¦ÙŠ</th>
                                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                <th>ØªÙ‚Ø¯ÙŠØ±</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${student.subjects.map(subject => `
                                <tr>
                                    <td>${subject.name}</td>
                                    <td>${subject.units}</td>
                                    <td>${subject.classwork}</td>
                                    <td>${subject.final}</td>
                                    <td>${subject.total}</td>
                                    <td>${getGrade(subject.total)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Delete Student
        function deleteStudent(studentId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ')) return;
            
            students = students.filter(s => s.id !== studentId);
            localStorage.setItem('students', JSON.stringify(students));
            displayStudents();
            showStatus('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // Block Student Functions
        function blockStudent() {
            const studentId = document.getElementById('blockStudentId').value.trim();
            const reason = document.getElementById('blockReason').value.trim();
            
            if (!studentId || !reason) {
                showStatus('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ ÙˆØ³Ø¨Ø¨ Ø§Ù„Ø­Ø¬Ø¨', 'error');
                return;
            }
            
            const student = students.find(s => s.id === studentId);
            if (!student) {
                showStatus('Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
                return;
            }
            
            const existingBlock = blockedStudents.find(b => b.studentId === studentId);
            if (existingBlock) {
                existingBlock.reason = reason;
                existingBlock.date = new Date().toISOString();
            } else {
                blockedStudents.push({
                    studentId: studentId,
                    studentName: student.name,
                    reason: reason,
                    date: new Date().toISOString()
                });
            }
            
            localStorage.setItem('blockedStudents', JSON.stringify(blockedStudents));
            showStatus('ØªÙ… Ø­Ø¬Ø¨ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            
            document.getElementById('blockStudentId').value = '';
            document.getElementById('blockReason').value = '';
        }

        function unblockStudent() {
            const studentId = document.getElementById('blockStudentId').value.trim();
            
            if (!studentId) {
                showStatus('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ', 'error');
                return;
            }
            
            const initialLength = blockedStudents.length;
            blockedStudents = blockedStudents.filter(b => b.studentId !== studentId);
            
            if (blockedStudents.length === initialLength) {
                showStatus('Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…Ø­Ø¬ÙˆØ¨', 'error');
                return;
            }
            
            localStorage.setItem('blockedStudents', JSON.stringify(blockedStudents));
            showStatus('ØªÙ… Ø±ÙØ¹ Ø­Ø¬Ø¨ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            
            document.getElementById('blockStudentId').value = '';
        }

        function loadBlockedStudents() {
            const listDiv = document.getElementById('blockedStudentsList');
            
            if (blockedStudents.length === 0) {
                listDiv.innerHTML = '<div class="no-results">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø­Ø¬ÙˆØ¨ÙˆÙ†</div>';
                return;
            }
            
            let html = '';
            blockedStudents.forEach(blocked => {
                html += `
                    <div class="student-card">
                        <div class="student-header">
                            <div class="student-info">
                                <h3>${blocked.studentName}</h3>
                                <p><strong>Ø§Ù„Ø±Ù‚Ù…:</strong> ${blocked.studentId}</p>
                                <p><strong>Ø§Ù„Ø³Ø¨Ø¨:</strong> ${blocked.reason}</p>
                                <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(blocked.date).toLocaleDateString('ar-SA')}</p>
                            </div>
                            <div>
                                <button onclick="unblockStudentById('${blocked.studentId}')" class="btn btn-success">âœ… Ø±ÙØ¹ Ø§Ù„Ø­Ø¬Ø¨</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            listDiv.innerHTML = html;
        }

        function unblockStudentById(studentId) {
            blockedStudents = blockedStudents.filter(b => b.studentId !== studentId);
            localStorage.setItem('blockedStudents', JSON.stringify(blockedStudents));
            loadBlockedStudents();
            showStatus('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø­Ø¬Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // Utility Functions
        function calculateGPA(subjects) {
            if (subjects.length === 0) return 0;
            
            const totalUnits = subjects.reduce((sum, subject) => sum + subject.units, 0);
            const weightedSum = subjects.reduce((sum, subject) => sum + (subject.total * subject.units), 0);
            
            return weightedSum / totalUnits;
        }

        function calculateSemesterStatus(subjects, gpa) {
            const failedRequired = subjects.some(subject => 
                subject.name.includes('(Ù…Ø·Ø§Ù„Ø¨)') && subject.total < 50
            );
            
            if (failedRequired) {
                return 'Ø±Ø§Ø³Ø¨';
            }
            
            const failedCount = subjects.filter(subject => subject.total < 50).length;
            
            if (failedCount > 2 || gpa < 50) {
                return 'Ø±Ø§Ø³Ø¨';
            } else {
                return 'Ù…Ù†Ù‚ÙˆÙ„';
            }
        }

        function getGrade(score) {
            const numScore = parseFloat(score) || 0;
            if (numScore >= 90) return 'Ù…Ù…ØªØ§Ø²';
            if (numScore >= 80) return 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹';
            if (numScore >= 70) return 'Ø¬ÙŠØ¯';
            if (numScore >= 60) return 'Ù…Ù‚Ø¨ÙˆÙ„';
            if (numScore >= 50) return 'Ù…Ù‚Ø¨ÙˆÙ„';
            return 'Ø¶Ø¹ÙŠÙ';
        }

        function getGpaClass(gpa) {
            if (gpa >= 90) return 'excellent';
            if (gpa >= 80) return 'very-good';
            if (gpa >= 70) return 'good';
            if (gpa >= 60) return 'pass';
            return 'fail';
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status-message status-${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
