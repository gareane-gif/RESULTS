<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø­Ø« Ø¹Ù† Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .search-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .search-input {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-input input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 18px;
            transition: all 0.3s;
        }

        .search-input input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .status-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .student-result {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f8f9fa;
        }

        .student-info h3 {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .student-info p {
            color: #666;
            margin: 5px 0;
            font-size: 1.1em;
        }

        .gpa-display {
            text-align: center;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            font-size: 1.4em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 25px 0;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-item strong {
            display: block;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .stat-item p {
            font-size: 1.5em;
            font-weight: bold;
            margin: 0;
        }

        .passed { color: #28a745; }
        .failed { color: #dc3545; }

        .subjects-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 25px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .subjects-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1em;
        }

        .subjects-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            font-size: 1.05em;
        }

        .subjects-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .subjects-table tr:hover {
            background: #e9ecef;
            transition: background 0.3s;
        }

        .grade-excellent { color: #28a745; font-weight: bold; }
        .grade-very-good { color: #17a2b8; font-weight: bold; }
        .grade-good { color: #ffc107; font-weight: bold; }
        .grade-pass { color: #6c757d; font-weight: bold; }
        .grade-fail { color: #dc3545; font-weight: bold; }

        .blocked-message {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 25px 0;
            border: 2px solid #dc3545;
        }

        .blocked-message h3 {
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .blocked-message p {
            margin: 10px 0;
            font-size: 1.1em;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2em;
            background: #f8f9fa;
            border-radius: 15px;
            margin: 20px 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.2em;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .data-status {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            color: #1976d2;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .search-input {
                flex-direction: column;
            }

            .student-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .subjects-table {
                font-size: 0.9em;
            }

            .subjects-table th,
            .subjects-table td {
                padding: 10px 5px;
            }
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ Ø¨Ø­Ø« Ø¹Ù† Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</h1>
            <p>Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù„Ø¹Ø±Ø¶ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</p>
        </div>

        <div id="dataStatus" class="data-status" style="display: none;">
            Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
        </div>

        <div class="search-section">
            <div class="search-input">
                <input type="text" id="searchId" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ" autocomplete="off">
                <button class="search-btn" onclick="searchStudent()">Ø¨Ø­Ø«</button>
            </div>
            <div id="searchResults"></div>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" onclick="loadSampleData()">ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
            <button class="btn btn-success" onclick="checkDataStatus">ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
    </div>

    <script>
        // Global variables
        let students = [];
        let blockedStudents = [];

        // Initialize on page load
        window.onload = function() {
            console.log('ğŸ“ Student Search Page Loaded');
            loadAllData();
            
            // Add enter key support for search
            document.getElementById('searchId').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchStudent();
                }
            });
        };

        // Load all data using multiple methods
        async function loadAllData() {
            const dataStatus = document.getElementById('dataStatus');
            dataStatus.style.display = 'block';
            dataStatus.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...';

            try {
                // Method 1: Try localStorage first
                const localStudents = localStorage.getItem('students');
                const localBlocked = localStorage.getItem('blockedStudents');
                
                if (localStudents) {
                    students = JSON.parse(localStudents);
                    console.log('âœ… Loaded students from localStorage:', students.length);
                }
                
                if (localBlocked) {
                    blockedStudents = JSON.parse(localBlocked);
                    console.log('âœ… Loaded blocked students from localStorage:', blockedStudents.length);
                }

                // Method 2: Try sessionStorage
                if (students.length === 0) {
                    const sessionStudents = sessionStorage.getItem('students');
                    if (sessionStudents) {
                        students = JSON.parse(sessionStudents);
                        console.log('âœ… Loaded students from sessionStorage:', students.length);
                    }
                }

                // Method 3: Try to load from main page using iframe
                if (students.length === 0) {
                    await loadFromMainPage();
                }

                // Method 4: Check URL parameters
                if (students.length === 0) {
                    loadFromURLParameters();
                }

                // Update status
                if (students.length > 0) {
                    dataStatus.textContent = `âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${students.length} Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­`;
                    dataStatus.style.background = 'linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%)';
                    dataStatus.style.color = '#155724';
                    dataStatus.style.borderColor = '#c3e6cb';
                    
                    setTimeout(() => {
                        dataStatus.style.display = 'none';
                    }, 3000);
                } else {
                    dataStatus.textContent = 'âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø§Ø¨ - Ø§Ø¶ØºØ· "ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©"';
                    dataStatus.style.background = 'linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%)';
                    dataStatus.style.color = '#856404';
                    dataStatus.style.borderColor = '#ffeaa7';
                }

            } catch (error) {
                console.error('âŒ Error loading data:', error);
                dataStatus.textContent = 'âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                dataStatus.style.background = 'linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%)';
                dataStatus.style.color = '#721c24';
                dataStatus.style.borderColor = '#f5c6cb';
            }
        }

        // Load data from main page using iframe
        function loadFromMainPage() {
            return new Promise((resolve) => {
                try {
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.src = 'index.html';
                    
                    iframe.onload = function() {
                        try {
                            const iframeStudents = iframe.contentWindow.students;
                            const iframeBlocked = iframe.contentWindow.blockedStudents;
                            
                            if (iframeStudents && iframeStudents.length > 0) {
                                students = iframeStudents;
                                localStorage.setItem('students', JSON.stringify(students));
                                console.log('âœ… Loaded students from iframe:', students.length);
                            }
                            
                            if (iframeBlocked && iframeBlocked.length > 0) {
                                blockedStudents = iframeBlocked;
                                localStorage.setItem('blockedStudents', JSON.stringify(blockedStudents));
                                console.log('âœ… Loaded blocked students from iframe:', blockedStudents.length);
                            }
                        } catch (error) {
                            console.log('âš ï¸ Could not access iframe data:', error);
                        }
                        
                        document.body.removeChild(iframe);
                        resolve();
                    };
                    
                    iframe.onerror = function() {
                        document.body.removeChild(iframe);
                        resolve();
                    };
                    
                    document.body.appendChild(iframe);
                    
                    // Timeout after 5 seconds
                    setTimeout(() => {
                        if (document.body.contains(iframe)) {
                            document.body.removeChild(iframe);
                        }
                        resolve();
                    }, 5000);
                    
                } catch (error) {
                    console.log('âš ï¸ Could not create iframe:', error);
                    resolve();
                }
            });
        }

        // Load data from URL parameters
        function loadFromURLParameters() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const studentsData = urlParams.get('students');
                
                if (studentsData) {
                    const decodedData = decodeURIComponent(studentsData);
                    const parsedData = JSON.parse(decodedData);
                    
                    if (Array.isArray(parsedData) && parsedData.length > 0) {
                        students = parsedData;
                        localStorage.setItem('students', JSON.stringify(students));
                        console.log('âœ… Loaded students from URL parameters:', students.length);
                    }
                }
            } catch (error) {
                console.log('âš ï¸ Could not load from URL parameters:', error);
            }
        }

        // Load sample data
        function loadSampleData() {
            students = [
                {
                    id: 'CO242001',
                    name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ',
                    department: 'Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³ÙˆØ¨',
                    semester: 1,
                    subjects: [
                        { name: 'Ø¨Ø±Ù…Ø¬Ø© 2 (Ù…Ø·Ø§Ù„Ø¨)', units: 3, classwork: 18, final: 32, total: 50 },
                        { name: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©', units: 2, classwork: 15, final: 25, total: 40 },
                        { name: 'Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª', units: 3, classwork: 20, final: 35, total: 55 },
                        { name: 'Ø´Ø¨ÙƒØ§Øª Ø­Ø§Ø³ÙˆØ¨', units: 2, classwork: 16, final: 28, total: 44 }
                    ]
                },
                {
                    id: 'CO242002',
                    name: 'ÙØ§Ø·Ù…Ø© Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø§Ù„Ù…',
                    department: 'Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³ÙˆØ¨',
                    semester: 1,
                    subjects: [
                        { name: 'Ø¨Ø±Ù…Ø¬Ø© 2 (Ù…Ø·Ø§Ù„Ø¨)', units: 3, classwork: 10, final: 15, total: 25 },
                        { name: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©', units: 2, classwork: 18, final: 30, total: 48 },
                        { name: 'Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª', units: 3, classwork: 19, final: 31, total: 50 },
                        { name: 'Ø´Ø¨ÙƒØ§Øª Ø­Ø§Ø³ÙˆØ¨', units: 2, classwork: 17, final: 29, total: 46 }
                    ]
                },
                {
                    id: 'CO242003',
                    name: 'Ù…Ø­Ù…Ø¯ Ø®Ø§Ù„Ø¯ Ø¹Ù…Ø±',
                    department: 'Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³ÙˆØ¨',
                    semester: 1,
                    subjects: [
                        { name: 'Ø¨Ø±Ù…Ø¬Ø© 2 (Ù…Ø·Ø§Ù„Ø¨)', units: 3, classwork: 25, final: 45, total: 70 },
                        { name: 'Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©', units: 2, classwork: 20, final: 35, total: 55 },
                        { name: 'Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª', units: 3, classwork: 23, final: 42, total: 65 },
                        { name: 'Ø´Ø¨ÙƒØ§Øª Ø­Ø§Ø³ÙˆØ¨', units: 2, classwork: 22, final: 38, total: 60 }
                    ]
                }
            ];

            localStorage.setItem('students', JSON.stringify(students));
            
            const dataStatus = document.getElementById('dataStatus');
            dataStatus.style.display = 'block';
            dataStatus.textContent = `âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${students.length} Ø·Ù„Ø§Ø¨ ØªØ¬Ø±ÙŠØ¨ÙŠÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­`;
            dataStatus.style.background = 'linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%)';
            dataStatus.style.color = '#155724';
            dataStatus.style.borderColor = '#c3e6cb';
            
            setTimeout(() => {
                dataStatus.style.display = 'none';
            }, 3000);
        }

        // Check data status
        function checkDataStatus() {
            const dataStatus = document.getElementById('dataStatus');
            dataStatus.style.display = 'block';
            
            const localStudents = localStorage.getItem('students');
            const sessionStudents = sessionStorage.getItem('students');
            
            let statusText = `ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:\n`;
            statusText += `localStorage: ${localStudents ? JSON.parse(localStudents).length : 0} Ø·Ø§Ù„Ø¨\n`;
            statusText += `sessionStorage: ${sessionStudents ? JSON.parse(sessionStudents).length : 0} Ø·Ø§Ù„Ø¨\n`;
            statusText += `Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø­Ø§Ù„ÙŠ: ${students.length} Ø·Ø§Ù„Ø¨`;
            
            dataStatus.textContent = statusText;
            dataStatus.style.whiteSpace = 'pre-line';
            dataStatus.style.textAlign = 'right';
            
            setTimeout(() => {
                dataStatus.style.display = 'none';
            }, 5000);
        }

        // Search student
        function searchStudent() {
            const searchId = document.getElementById('searchId').value.trim();
            const resultsDiv = document.getElementById('searchResults');
            
            if (!searchId) {
                resultsDiv.innerHTML = '<div class="no-results">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</div>';
                return;
            }
            
            if (students.length === 0) {
                resultsDiv.innerHTML = '<div class="no-results">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø§Ø¨ - Ø§Ø¶ØºØ· "ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©"</div>';
                return;
            }
            
            const student = students.find(s => s.id === searchId);
            
            if (!student) {
                resultsDiv.innerHTML = '<div class="no-results">Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</div>';
                return;
            }
            
            // Check if student is blocked
            const blocked = blockedStudents.find(b => b.studentId === searchId);
            
            if (blocked) {
                resultsDiv.innerHTML = `
                    <div class="student-result">
                        <div class="student-header">
                            <div class="student-info">
                                <h3>${student.name}</h3>
                                <p>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ: ${student.id}</p>
                                <p>Ø§Ù„Ù‚Ø³Ù…: ${student.department}</p>
                                <p>Ø§Ù„ÙØµÙ„: ${student.semester}</p>
                            </div>
                        </div>
                        <div class="blocked-message">
                            <h3>ğŸš« Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ø­Ø¬ÙˆØ¨Ø©</h3>
                            <p><strong>Ø§Ù„Ø³Ø¨Ø¨:</strong> ${blocked.reason}</p>
                            <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(blocked.date).toLocaleDateString('ar-SA')}</p>
                            <p style="margin-top: 15px; font-size: 1.2em;">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù„Ø¬Ù†Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            const gpa = calculateGPA(student.subjects);
            const status = calculateSemesterStatus(student.subjects, gpa);
            const passedSubjects = student.subjects.filter(s => s.total >= 50).length;
            const failedSubjects = student.subjects.filter(s => s.total < 50).length;
            
            let subjectsTableHTML = `
                <table class="subjects-table">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                            <th>Ø§Ù„ÙˆØ­Ø¯Ø§Øª</th>
                            <th>Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</th>
                            <th>Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th>
                            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                            <th>Ø§Ù„ØªÙ‚Ø¯ÙŠØ±</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            student.subjects.forEach(subject => {
                const grade = getGrade(subject.total);
                const gradeClass = getGradeClass(subject.total);
                
                subjectsTableHTML += `
                    <tr>
                        <td>${subject.name}</td>
                        <td>${subject.units}</td>
                        <td>${subject.classwork}</td>
                        <td>${subject.final}</td>
                        <td>${subject.total}</td>
                        <td class="${gradeClass}">${grade}</td>
                    </tr>
                `;
            });
            
            subjectsTableHTML += '</tbody></table>';
            
            resultsDiv.innerHTML = `
                <div class="student-result">
                    <div class="student-header">
                        <div class="student-info">
                            <h3>${student.name}</h3>
                            <p>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ: ${student.id}</p>
                            <p>Ø§Ù„Ù‚Ø³Ù…: ${student.department}</p>
                            <p>Ø§Ù„ÙØµÙ„: ${student.semester}</p>
                        </div>
                    </div>
                    
                    <div class="gpa-display">
                        Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ø§Ù…: ${gpa.toFixed(2)}%
                        <br>
                        Ø§Ù„Ø­Ø§Ù„Ø©: ${status}
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <strong>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù†Ø§Ø¬Ø­Ø©</strong>
                            <p class="passed">${passedSubjects}</p>
                        </div>
                        <div class="stat-item">
                            <strong>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø±Ø§Ø³Ø¨Ø©</strong>
                            <p class="failed">${failedSubjects}</p>
                        </div>
                    </div>
                    
                    ${subjectsTableHTML}
                </div>
            `;
        }

        // Calculate GPA
        function calculateGPA(subjects) {
            if (subjects.length === 0) return 0;
            
            const totalUnits = subjects.reduce((sum, subject) => sum + subject.units, 0);
            const weightedSum = subjects.reduce((sum, subject) => sum + (subject.total * subject.units), 0);
            
            return weightedSum / totalUnits;
        }

        // Calculate semester status
        function calculateSemesterStatus(subjects, gpa) {
            // Check if failed any required subject (Ù…Ø·Ø§Ù„Ø¨)
            const failedRequired = subjects.some(subject => 
                subject.name.includes('(Ù…Ø·Ø§Ù„Ø¨)') && subject.total < 50
            );
            
            if (failedRequired) {
                return 'Ø±Ø§Ø³Ø¨';
            }
            
            // Count failed subjects
            const failedCount = subjects.filter(subject => subject.total < 50).length;
            
            // Status logic
            if (failedCount > 2 || gpa < 50) {
                return 'Ø±Ø§Ø³Ø¨';
            } else {
                return 'Ù…Ù†Ù‚ÙˆÙ„';
            }
        }

        // Get grade based on score
        function getGrade(score) {
            const numScore = parseFloat(score) || 0;
            if (numScore >= 90) return 'Ù…Ù…ØªØ§Ø²';
            if (numScore >= 80) return 'Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹';
            if (numScore >= 70) return 'Ø¬ÙŠØ¯';
            if (numScore >= 60) return 'Ù…Ù‚Ø¨ÙˆÙ„';
            if (numScore >= 50) return 'Ù…Ù‚Ø¨ÙˆÙ„';
            return 'Ø¶Ø¹ÙŠÙ';
        }

        // Get grade class for styling
        function getGradeClass(score) {
            const numScore = parseFloat(score) || 0;
            if (numScore >= 80) return 'grade-excellent';
            if (numScore >= 70) return 'grade-very-good';
            if (numScore >= 60) return 'grade-good';
            if (numScore >= 50) return 'grade-pass';
            return 'grade-fail';
        }
    </script>
</body>
</html>
