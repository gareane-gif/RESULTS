<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ­Øµ Firebase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .container {
            background: #2a2a2a;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        h1 {
            text-align: center;
            color: #4CAF50;
            margin-bottom: 30px;
        }
        
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #333;
            border-radius: 8px;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #45a049;
        }
        
        .btn-danger {
            background: #f44336;
        }
        
        .btn-danger:hover {
            background: #da190b;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .status.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
            color: #4CAF50;
        }
        
        .status.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            color: #f44336;
        }
        
        .status.info {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid #2196F3;
            color: #2196F3;
        }
        
        .log {
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 10px;
            background: #444;
            color: white;
            border: 1px solid #666;
            border-radius: 5px;
            margin: 5px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ÙØ­Øµ Firebase</h1>
    
    <div class="section">
        <h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase</h2>
        <div id="firebaseStatus"></div>
        
        <div style="margin: 15px 0;">
            <label>API Key:</label>
            <input type="text" id="apiKey" placeholder="AIzaSyYOUR_API_KEY" value="AIzaSyYOUR_API_KEY">
            
            <label>Project ID:</label>
            <input type="text" id="projectId" placeholder="your-project" value="your-project">
            
            <button class="btn" onclick="initializeFirebase()">ğŸ”— Ø±Ø¨Ø· Firebase</button>
        </div>
    </div>
    
    <div class="section">
        <h2>ğŸ“Š Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</h2>
        <button class="btn" onclick="testConnection()">ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
        <button class="btn" onclick="testWrite()">âœï¸ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©</button>
        <button class="btn" onclick="testRead()">ğŸ“– Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</button>
        <div id="testStatus"></div>
    </div>
    
    <div class="section">
        <h2>ğŸ“¤ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</h2>
        <button class="btn" onclick="testSync()">ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</button>
        <button class="btn btn-danger" onclick="clearFirebase()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <div id="syncStatus"></div>
    </div>
    
    <div class="section">
        <h2>ğŸ“ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h2>
        <button class="btn" onclick="clearLogs()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
        <div id="logs" class="log"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    
    <script>
        let db;
        let logs = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push(logEntry);
            
            const logsDiv = document.getElementById('logs');
            logsDiv.innerHTML = logs.join('\n');
            logsDiv.scrollTop = logsDiv.scrollHeight;
            
            console.log(logEntry);
        }
        
        function clearLogs() {
            logs = [];
            document.getElementById('logs').innerHTML = '';
        }
        
        function initializeFirebase() {
            const apiKey = document.getElementById('apiKey').value;
            const projectId = document.getElementById('projectId').value;
            const statusDiv = document.getElementById('firebaseStatus');
            
            if (!apiKey || !projectId) {
                statusDiv.innerHTML = '<div class="status error">âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ API Key Ùˆ Project ID</div>';
                return;
            }
            
            const firebaseConfig = {
                apiKey: apiKey,
                authDomain: `${projectId}.firebaseapp.com`,
                projectId: projectId,
                storageBucket: `${projectId}.appspot.com`,
                messagingSenderId: "123456789",
                appId: "1:123456789:web:abcdef"
            };

            try {
                // Initialize Firebase
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                db = firebase.firestore();
                statusDiv.innerHTML = '<div class="status success">âœ… ØªÙ… Ø±Ø¨Ø· Firebase Ø¨Ù†Ø¬Ø§Ø­</div>';
                log('Firebase initialized successfully');
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø±Ø¨Ø· Firebase: ${error.message}</div>`;
                log(`Firebase initialization error: ${error.message}`, 'error');
            }
        }
        
        async function testConnection() {
            if (!db) {
                document.getElementById('testStatus').innerHTML = '<div class="status error">âŒ Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ£</div>';
                return;
            }
            
            try {
                log('Testing connection...');
                const testDoc = await db.collection('test').doc('connection').get();
                document.getElementById('testStatus').innerHTML = '<div class="status success">âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­</div>';
                log('Connection test successful');
            } catch (error) {
                document.getElementById('testStatus').innerHTML = `<div class="status error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}</div>`;
                log(`Connection test failed: ${error.message}`, 'error');
            }
        }
        
        async function testWrite() {
            if (!db) {
                document.getElementById('testStatus').innerHTML = '<div class="status error">âŒ Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ£</div>';
                return;
            }
            
            try {
                log('Testing write operation...');
                await db.collection('test').doc('writeTest').set({
                    message: 'Test write',
                    timestamp: Date.now()
                });
                document.getElementById('testStatus').innerHTML = '<div class="status success">âœ… Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù†Ø§Ø¬Ø­Ø©</div>';
                log('Write test successful');
            } catch (error) {
                document.getElementById('testStatus').innerHTML = `<div class="status error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø©: ${error.message}</div>`;
                log(`Write test failed: ${error.message}`, 'error');
            }
        }
        
        async function testRead() {
            if (!db) {
                document.getElementById('testStatus').innerHTML = '<div class="status error">âŒ Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ£</div>';
                return;
            }
            
            try {
                log('Testing read operation...');
                const testDoc = await db.collection('test').doc('writeTest').get();
                if (testDoc.exists) {
                    const data = testDoc.data();
                    document.getElementById('testStatus').innerHTML = '<div class="status success">âœ… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù†Ø§Ø¬Ø­Ø©</div>';
                    log(`Read test successful: ${JSON.stringify(data)}`);
                } else {
                    document.getElementById('testStatus').innerHTML = '<div class="status info">â„¹ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>';
                    log('Read test: no data found');
                }
            } catch (error) {
                document.getElementById('testStatus').innerHTML = `<div class="status error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: ${error.message}</div>`;
                log(`Read test failed: ${error.message}`, 'error');
            }
        }
        
        async function testSync() {
            if (!db) {
                document.getElementById('syncStatus').innerHTML = '<div class="status error">âŒ Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ£</div>';
                return;
            }
            
            try {
                log('Testing sync operation...');
                
                // Test data
                const testStudents = [
                    {
                        id: 'TEST001',
                        name: 'Ø·Ø§Ù„Ø¨ Ø§Ø®ØªØ¨Ø§Ø±',
                        department: 'Ù‚Ø³Ù… Ø§Ø®ØªØ¨Ø§Ø±',
                        semester: 'Ø§Ø®ØªØ¨Ø§Ø±',
                        timestamp: Date.now()
                    }
                ];
                
                // Clear existing test data
                const snapshot = await db.collection('students').get();
                const batch = db.batch();
                snapshot.docs.forEach(doc => {
                    batch.delete(doc.ref);
                });
                await batch.commit();
                log('Cleared existing test data');
                
                // Add test data
                for (const student of testStudents) {
                    await db.collection('students').doc(student.id).set(student);
                }
                log('Added test data');
                
                // Read back
                const readSnapshot = await db.collection('students').get();
                const readStudents = [];
                readSnapshot.forEach(doc => {
                    readStudents.push(doc.data());
                });
                
                document.getElementById('syncStatus').innerHTML = `<div class="status success">âœ… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù†Ø§Ø¬Ø­Ø© - ${readStudents.length} Ø·Ø§Ù„Ø¨</div>`;
                log(`Sync test successful: ${readStudents.length} students synced`);
                
            } catch (error) {
                document.getElementById('syncStatus').innerHTML = `<div class="status error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©: ${error.message}</div>`;
                log(`Sync test failed: ${error.message}`, 'error');
            }
        }
        
        async function clearFirebase() {
            if (!db) {
                document.getElementById('syncStatus').innerHTML = '<div class="status error">âŒ Firebase ØºÙŠØ± Ù…Ù‡ÙŠØ£</div>';
                return;
            }
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
                return;
            }
            
            try {
                log('Clearing Firebase data...');
                const snapshot = await db.collection('students').get();
                const batch = db.batch();
                snapshot.docs.forEach(doc => {
                    batch.delete(doc.ref);
                });
                await batch.commit();
                
                document.getElementById('syncStatus').innerHTML = '<div class="status success">âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­</div>';
                log('Firebase data cleared successfully');
                
            } catch (error) {
                document.getElementById('syncStatus').innerHTML = `<div class="status error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø³Ø­: ${error.message}</div>`;
                log(`Clear operation failed: ${error.message}`, 'error');
            }
        }
        
        // Initialize on load
        window.onload = function() {
            log('Firebase debug tool loaded');
            document.getElementById('firebaseStatus').innerHTML = '<div class="status info">â„¹ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±Ø¨Ø· Firebase Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>';
        };
    </script>
</body>
</html>
