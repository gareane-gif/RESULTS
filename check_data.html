<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…ÙˆØ§Ø¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            direction: rtl;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        .student-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
        }
        .subject-item {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 5px;
            border: 1px solid #bbdefb;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-success {
            background: #28a745;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #ffeaa7;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #f5c6cb;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }
        th {
            background: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…ÙˆØ§Ø¯</h1>
        
        <div class="section">
            <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
            <div id="statistics"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ“ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
            <div id="studentsList"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ“š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ù„ÙƒÙ„ Ø·Ø§Ù„Ø¨</h3>
            <div id="subjectsDetails"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ”§ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ…</h3>
            <button class="btn" onclick="loadData()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button class="btn btn-danger" onclick="clearStudents()">Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨</button>
            <button class="btn btn-success" onclick="exportData()">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button class="btn" onclick="clearAllData()">Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>
        
        <div class="section">
            <h3>ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª localStorage</h3>
            <div id="localStorageData"></div>
        </div>
        
        <div id="messages"></div>
    </div>

    <script>
        function showMessage(message, type = 'info') {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = message;
            messagesDiv.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
        
        function loadData() {
            loadStatistics();
            loadStudents();
            loadSubjectsDetails();
            loadLocalStorageData();
        }
        
        function loadStatistics() {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const settings = JSON.parse(localStorage.getItem('adminSettings')) || {};
            const departments = JSON.parse(localStorage.getItem('departments')) || [];
            const departmentSubjects = JSON.parse(localStorage.getItem('departmentSubjects')) || {};
            const blockedStudents = JSON.parse(localStorage.getItem('blockedStudents')) || [];
            
            const statsDiv = document.getElementById('statistics');
            statsDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; border: 1px solid #ddd;">
                        <div style="font-size: 24px; font-weight: bold; color: #007bff;">${students.length}</div>
                        <div style="color: #666;">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; border: 1px solid #ddd;">
                        <div style="font-size: 24px; font-weight: bold; color: #28a745;">${departments.length}</div>
                        <div style="color: #666;">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; border: 1px solid #ddd;">
                        <div style="font-size: 24px; font-weight: bold; color: #17a2b8;">${Object.keys(departmentSubjects).length}</div>
                        <div style="color: #666;">Ø£Ù‚Ø³Ø§Ù… Ø¨Ù…ÙˆØ§Ø¯</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: white; border: 8px; border: 1px solid #ddd;">
                        <div style="font-size: 24px; font-weight: bold; color: #dc3545;">${blockedStudents.length}</div>
                        <div style="color: #666;">Ø·Ù„Ø§Ø¨ Ù…Ø­Ø¬ÙˆØ¨ÙŠÙ†</div>
                    </div>
                </div>
            `;
        }
        
        function loadStudents() {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const studentsDiv = document.getElementById('studentsList');
            
            if (students.length === 0) {
                studentsDiv.innerHTML = '<div class="warning">âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</div>';
                return;
            }
            
            let html = '';
            students.forEach(student => {
                const hasSubjects = student.subjects && student.subjects.length > 0;
                html += `
                    <div class="student-item">
                        <h4>ğŸ‘¤ ${student.name}</h4>
                        <p><strong>Ø§Ù„Ø±Ù‚Ù…:</strong> ${student.id}</p>
                        <p><strong>Ø§Ù„Ù‚Ø³Ù…:</strong> ${student.department}</p>
                        <p><strong>Ø§Ù„ÙØµÙ„:</strong> ${student.semester}</p>
                        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¯:</strong> <span style="color: ${hasSubjects ? '#28a745' : '#dc3545'}; font-weight: bold;">${student.subjects ? student.subjects.length : 0}</span></p>
                        <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</strong> ${student.addedDate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                        <p><strong>Ù„Ø¯ÙŠÙ‡ Ù…ÙˆØ§Ø¯:</strong> ${hasSubjects ? 'âœ… Ù†Ø¹Ù…' : 'âŒ Ù„Ø§'}</p>
                    </div>
                `;
            });
            
            studentsDiv.innerHTML = html;
        }
        
        function loadSubjectsDetails() {
            const students = JSON.parse(localStorage.getItem('students')) || [];
            const subjectsDiv = document.getElementById('subjectsDetails');
            
            let totalSubjects = 0;
            let studentsWithSubjects = 0;
            let subjectsByDepartment = {};
            
            students.forEach(student => {
                if (student.subjects && student.subjects.length > 0) {
                    studentsWithSubjects++;
                    totalSubjects += student.subjects.length;
                    
                    const dept = student.department || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    if (!subjectsByDepartment[dept]) {
                        subjectsByDepartment[dept] = [];
                    }
                    
                    student.subjects.forEach(subject => {
                        subjectsByDepartment[dept].push({
                            studentName: student.name,
                            studentId: student.id,
                            subjectName: subject.name,
                            units: subject.units,
                            total: subject.total,
                            evaluation: subject.evaluation
                        });
                    });
                }
            });
            
            let html = `
                <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 15px;">
                    <h4>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ§Ø¯</h4>
                    <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø¯:</strong> ${totalSubjects}</p>
                    <p><strong>Ø·Ù„Ø§Ø¨ Ù„Ø¯ÙŠÙ‡Ù… Ù…ÙˆØ§Ø¯:</strong> ${studentsWithSubjects}</p>
                    <p><strong>Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…ÙˆØ§Ø¯ Ù„ÙƒÙ„ Ø·Ø§Ù„Ø¨:</strong> ${studentsWithSubjects > 0 ? (totalSubjects / studentsWithSubjects).toFixed(2) : 0}</p>
                </div>
            `;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
            Object.keys(subjectsByDepartment).forEach(dept => {
                html += `
                    <div class="student-item">
                        <h4>ğŸ›ï¸ ${dept}</h4>
                        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¯:</strong> ${subjectsByDepartment[dept].length}</p>
                `;
                
                subjectsByDepartment[dept].forEach((item, index) => {
                    html += `
                        <div class="subject-item">
                            <strong>${index + 1}. ${item.subjectName}</strong> (${item.units} ÙˆØ­Ø¯Ø§Øª) - Ø§Ù„Ø·Ø§Ù„Ø¨: ${item.studentName} - Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${item.total}
                        </div>
                    `;
                });
                
                html += '</div>';
            });
            
            subjectsDiv.innerHTML = html;
        }
        
        function loadLocalStorageData() {
            const dataDiv = document.getElementById('localStorageData');
            
            const allKeys = [];
            for (let i = 0; i < localStorage.length; i++) {
                allKeys.push(localStorage.key(i));
            }
            
            let html = '<h4>ğŸ”‘ Ù…ÙØ§ØªØ§Ø­ÙŠÙ„ localStorage:</h4>';
            html += '<ul>';
            allKeys.forEach(key => {
                const value = localStorage.getItem(key);
                const size = new Blob([value]).size;
                html += `<li><strong>${key}:</strong> (${size} bytes) - ${value ? 'Ù…ÙˆØ¬ÙˆØ¯' : 'ÙØ§Ø±Øº'}</li>`;
            });
            html += '</ul>';
            
            // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨Ø§Ù„ØªÙØµÙŠÙ„
            const students = JSON.parse(localStorage.getItem('students')) || [];
            html += '<h4>ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„ÙƒØ§Ù…Ù„Ø©:</h4>';
            html += '<pre>' + JSON.stringify(students, null, 2) + '</pre>';
            
            dataDiv.innerHTML = html;
        }
        
        function clearStudents() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ØŸ')) {
                localStorage.removeItem('students');
                showMessage('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadData();
            }
        }
        
        function exportData() {
            const data = {
                students: JSON.parse(localStorage.getItem('students')) || [],
                settings: JSON.parse(localStorage.getItem('adminSettings')) || {},
                departments: JSON.parse(localStorage.getItem('departments')) || [],
                departmentSubjects: JSON.parse(localStorage.getItem('departmentSubjects')) || {},
                blockedStudents: JSON.parse(localStorage.getItem('blockedStudents')) || [],
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `students_data_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showMessage('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
        
        function clearAllData() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
                localStorage.clear();
                showMessage('ØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadData();
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            loadData();
        };
    </script>
</body>
</html>
